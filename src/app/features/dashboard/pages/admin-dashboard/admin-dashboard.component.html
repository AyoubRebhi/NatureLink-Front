<div class="admin-dashboard">
  <h2>User Management</h2>

  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner diameter="50"></mat-spinner>
    <p>Loading data...</p>
  </div>

  <div *ngIf="errorMessage" class="error-container mat-elevation-z2">
    <mat-icon>error_outline</mat-icon>
    <div class="error-message">{{ errorMessage }}</div>
  </div>

  <div *ngIf="!isLoading && !errorMessage" class="tabs-container">
    <mat-tab-group>
      <!-- Active Users Tab -->
      <mat-tab label="Active Users">
        <div class="table-container">
          <table mat-table [dataSource]="usersDataSource" class="mat-elevation-z8 user-table">
            <!-- ID Column -->
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef>ID</th>
              <td mat-cell *matCellDef="let user">{{ user.id }}</td>
            </ng-container>

            <!-- Username Column -->
            <ng-container matColumnDef="username">
              <th mat-header-cell *matHeaderCellDef>Username</th>
              <td mat-cell *matCellDef="let user">{{ user.username }}</td>
            </ng-container>

            <!-- Email Column -->
            <ng-container matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef>Email</th>
              <td mat-cell *matCellDef="let user">{{ user.email }}</td>
            </ng-container>

            <!-- Role Column -->
            <ng-container matColumnDef="role">
              <th mat-header-cell *matHeaderCellDef>Role</th>
              <td mat-cell *matCellDef="let user">{{ user.role }}</td>
            </ng-container>

            <!-- Status Column -->
            <ng-container matColumnDef="status">
              <th mat-header-cell *matHeaderCellDef>Status</th>
              <td mat-cell *matCellDef="let user">
                <span class="status-badge" [class.blocked]="user.blocked">
                  {{ user.blocked ? 'Blocked' : 'Active' }}
                </span>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let user">
                <div class="action-buttons">
                  <!-- Block Button -->
                  <button mat-raised-button 
                          *ngIf="!user.blocked"
                          (click)="blockUser(user)"
                          color="warn"
                          class="action-button"
                          matTooltip="Block user">
                    <span>Block</span>
                  </button>
                  
                  <!-- Unblock Button -->
                  <button mat-raised-button 
                          *ngIf="user.blocked"
                          (click)="unblockUser(user)"
                          color="primary"
                          class="action-button"
                          matTooltip="Unblock user">
                    <span>Unblock</span>
                  </button>
                  <button mat-raised-button
                          color="accent"
                          class="action-button"
                          (click)="viewUserPayments(user)">
                    <span>Payments</span>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
          </table>

          <div *ngIf="usersDataSource.data.length === 0" class="no-data-message">
            <mat-icon class="no-data-icon">group_off</mat-icon>
            <h3>No active users found in the system</h3>
          </div>
        </div>
      </mat-tab>

      <!-- Pending Users Tab -->
      <mat-tab label="Pending Users">
        <div class="table-container">
          <table mat-table [dataSource]="pendingUsersDataSource" class="mat-elevation-z8 user-table">
            <!-- ID Column -->
            <ng-container matColumnDef="id">
              <th mat-header-cell *matHeaderCellDef>ID</th>
              <td mat-cell *matCellDef="let pendingUser">{{ pendingUser.id }}</td>
            </ng-container>

            <!-- Username Column -->
            <ng-container matColumnDef="username">
              <th mat-header-cell *matHeaderCellDef>Username</th>
              <td mat-cell *matCellDef="let pendingUser">{{ pendingUser.username }}</td>
            </ng-container>

            <!-- Email Column -->
            <ng-container matColumnDef="email">
              <th mat-header-cell *matHeaderCellDef>Email</th>
              <td mat-cell *matCellDef="let pendingUser">{{ pendingUser.email }}</td>
            </ng-container>

            <!-- Role Column -->
            <ng-container matColumnDef="role">
              <th mat-header-cell *matHeaderCellDef>Role</th>
              <td mat-cell *matCellDef="let pendingUser">{{ pendingUser.role }}</td>
            </ng-container>

            <!-- Proof Document Column -->
            <ng-container matColumnDef="proofDocument">
              <th mat-header-cell *matHeaderCellDef>Proof Document</th>
              <td mat-cell *matCellDef="let pendingUser">
                <a *ngIf="pendingUser.proofDocument" [href]="pendingUser.proofDocument" target="_blank">View</a>
                <span *ngIf="!pendingUser.proofDocument">N/A</span>
              </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions">
              <th mat-header-cell *matHeaderCellDef>Actions</th>
              <td mat-cell *matCellDef="let pendingUser">
                <div class="action-buttons">
                  <button mat-raised-button
                          color="primary"
                          class="action-button"
                          (click)="approvePendingUser(pendingUser)"
                          matTooltip="Approve user">
                    <span>Approve</span>
                  </button>
                  <button mat-raised-button
                          color="warn"
                          class="action-button"
                          (click)="rejectPendingUser(pendingUser)"
                          matTooltip="Reject user">
                    <span>Reject</span>
                  </button>
                </div>
              </td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="pendingDisplayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: pendingDisplayedColumns;"></tr>
          </table>

          <div *ngIf="pendingUsersDataSource.data.length === 0" class="no-data-message">
            <mat-icon class="no-data-icon">hourglass_empty</mat-icon>
            <h3>No pending users found</h3>
          </div>
        </div>
      </mat-tab>
    </mat-tab-group>
  </div>
</div>